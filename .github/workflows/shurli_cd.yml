name: Shurli CI

on:
  push:
    branches:
    - grewal
  # schedule:
    # Run at 00:00 UTC on Monday
    # - cron:  "0 0 * * 1"

jobs:

  all-builds:
    name: all-builds
    runs-on: ubuntu-latest

    steps:
      - name: Set up Go 1.14+
        uses: actions/setup-go@v2
        with:
          go-version: '^1.14.1' # The Go version to download (if necessary) and use.
      
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Build Shurli (Linux)
        env:
          DEBIAN_FRONTEND: noninteractive
        run: |
          mkdir -p $HOME/go/{bin,src,pkg} && \
          go get -u github.com/Meshbits/shurli && \
          cd $HOME/go/src/github.com/Meshbits/shurli && \
          make build-linux
      
      - name: Build Shurli (MacOS)
        env:
          DEBIAN_FRONTEND: noninteractive
        run: |
          cd $HOME/go/src/github.com/Meshbits/shurli && \
          make build-osx

      - name: Build Shurli (Winblows)
        env:
          DEBIAN_FRONTEND: noninteractive
        run: |
          cd $HOME/go/src/github.com/Meshbits/shurli && \
          make build-win

      - name: Upload shurli-linux.tar.gz as artifact
        uses: actions/upload-artifact@v1
        with:
          name: shurli_linux.tar.gz
          path: /home/runner/go/src/github.com/Meshbits/shurli/dist/shurli_linux.tar.gz
      
      - name: Upload shurli_macos.tar.gz as artifact
        uses: actions/upload-artifact@v1
        with:
          name: shurli_macos.tar.gz
          path: /home/runner/go/src/github.com/Meshbits/shurli/dist/shurli_macos.tar.gz
        
      - name: Upload shurli_win.tar.gz as artifact
        uses: actions/upload-artifact@v1
        with:
          name: shurli_win.tar.gz
          path: /home/runner/go/src/github.com/Meshbits/shurli/dist/shurli_win.tar.gz
